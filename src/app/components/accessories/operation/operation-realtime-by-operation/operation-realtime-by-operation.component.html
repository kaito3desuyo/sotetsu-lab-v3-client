<div class="operation-realtime-by-operation-container mat-elevation-z1">
  <perfect-scrollbar>
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="operationNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>運用</th>
        <td mat-cell *matCellDef="let element">
          <div
            fxLayout="row"
            fxLayoutAlign="center center"
            style="width: 36px; height: 36px; border-radius: 50%"
            [ngStyle]="{
              background: getOperationNumberColor(element.operationNumber)
            }"
          >
            <span>{{ element.operationNumber }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="formationNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>編成</th>
        <td mat-cell *matCellDef="let element">
          <div
            [ngClass]="[
              isIncrementData(element.updateTime) ||
              element.formationNumber === '不明'
                ? 'duplicate'
                : ''
            ]"
          >
            <span>
              {{ element.formationNumber }}
            </span>
            <span *ngIf="isIncrementData(element.updateTime)">?</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="history">
        <th mat-header-cell *matHeaderCellDef>履歴</th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            (click)="openHistoryDialog(element.operationNumber)"
          >
            <mat-icon>history</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="currentPoint">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>現在地</th>
        <td mat-cell *matCellDef="let element">
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
            <div fxFlex="1 0 32px">
              <a
                fxLayout="column"
                [ngStyle]="{
                  color: returnCurrentPoint(element.operationNumber)
                    ?.tripClassColor
                }"
                [routerLink]="[
                  '/timetable/all-line',
                  {
                    dia: calender.id,
                    direction: returnCurrentPoint(element.operationNumber)
                      ?.tripDirection,
                    trip: returnCurrentPoint(element.operationNumber)?.tripId
                  }
                ]"
              >
                <span>{{
                  returnCurrentPoint(element.operationNumber)?.tripClass
                }}</span>
                <span>{{
                  returnCurrentPoint(element.operationNumber)?.tripNumber
                }}</span>
              </a>
            </div>
            <div fxLayout="column" fxFlex="1 0 60px">
              <span>{{
                returnCurrentPoint(element.operationNumber)?.startStation
              }}</span>

              <span>{{
                returnCurrentPoint(element.operationNumber)?.startTime
              }}</span>
            </div>

            <div fxFlex="auto" fxLayout="row" fxLayoutAlign="start center">
              <mat-icon>arrow_forward</mat-icon>
            </div>

            <div fxLayout="column" fxFlex="1 0 60px">
              <span>{{
                returnCurrentPoint(element.operationNumber)?.endStation
              }}</span>
              <span>
                {{ returnCurrentPoint(element.operationNumber)?.endTime }}</span
              >
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="sightingTime">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>目撃</th>
        <td mat-cell *matCellDef="let element">
          <span
            [ngClass]="[
              isIncrementData(element.updateTime) ||
              element.formationNumber === '不明'
                ? 'duplicate'
                : ''
            ]"
          >
            {{ element.sightingTime | date: 'MM/dd HH:mm' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="updateTime">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>更新</th>
        <td mat-cell *matCellDef="let element">
          <span
            [ngClass]="[
              isIncrementData(element.updateTime) ||
              element.formationNumber === '不明'
                ? 'duplicate'
                : ''
            ]"
          >
            {{ element.updateTime | date: 'MM/dd HH:mm' }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </perfect-scrollbar>
</div>
